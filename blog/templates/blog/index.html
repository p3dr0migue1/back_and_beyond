{% extends "blog/base.html" %}
{% load blog_tags %}

{% block content %}
    <section class="blog_posts">
        {% block posts %}
            {% if "query" in request.GET %}
                <h3>Posts containing "{{ cd.query }}"</h3>
                <p>Search returned {{ total_results }} result{{ total_results|pluralize }}</p>

                {% for result in results %}
                    {% with post=result.object %}
                        <h4><a href="{{ post.get_absolute_url }}">{{ post.title }}</a></h4>
                        {{ post.content|truncatewords:5 }}
                    {% endwith %}
                {% endfor %}
            {% else %}
                {% if posts %}
                    {% for post in posts %}
                        <article class="post">
                            <h2><a href="{{ post.get_absolute_url }}">{{ post.title }}</a></h2>
                            <div class="post_footer">
                                <span class="post-date"> {{ post.date_created|date:'D d M Y' }}</span>
                                {% if post.tags.all %}
                                    <span class="tags">Tags:
                                    {% for tag in post.tags.all %}
                                        <a href="{% url 'blog:posts_in_tag' tag.slug  %}">{{ tag.name }}</a>{% if not forloop.last %}, {% endif %}
                                    {% endfor %}
                                    </span>
                                {% else %}
                                    <span class="tags">No Tags assign to this post.</span>
                                {% endif %}
                            </div>
                        </article>
                    {% endfor %}
                {% else %}
                    <article class="post">
                        <h3>No posts to display yet..</h3>
                    </article>
                {% endif %}
            {% endif %}
        {% endblock posts %}
    </section>

    <nav class="blog_navigation">
        <h3>Search</h3>
        <div id="search">
            <form action="/blog/search/" method="get">
                <input type="text" name="query">
                <input type="submit" value="Search">
            </form>
        </div>
        <h3>Menu</h3>
        <ul>
            <li><a href="{% url 'blog:new-post' %}">Create New Post</a></li>
            <li><a href="{% url 'blog:new-tag' %}">Create New Tag</a></li>
        </ul>
        {% if tags %}
        <nav class="tags_menu">
            <h3>Tags</h3>
            <ul>
            {% for t_obj in tags %}
                <li><a href="{% url 'blog:posts_in_tag' t_obj.tag__slug %}">{{ t_obj.tag__name }}</a> {{ t_obj.tag__count }}</li>
            {% endfor %}
            </ul>
        </nav>
        {% endif %}
    </nav>
    <div class="pagination">
        <span class="step-links">
            {% if posts.has_previous %}
                <a href="?page={{ posts.previous_page_number }}">previous</a>
            {% endif %}
            <span class="current">
                Page {{ posts.number }} of {{ posts.paginator.num_pages }}.
            </span>
            {% if posts.has_next %}
                <a href="?page={{ posts.next_page_number }}">next</a>
            {% endif %}
        </span>
    </div>
{% endblock content %}
